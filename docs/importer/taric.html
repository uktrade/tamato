
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The Importer - Taric &#8212; TaMaTo 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="The Exporter" href="../exporter/index.html" />
    <link rel="prev" title="The Importer - Parsers and Namespaces" href="parsers_and_namespaces.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../exporter/index.html" title="The Exporter"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parsers_and_namespaces.html" title="The Importer - Parsers and Namespaces"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../code.html" >Code Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">The Importer</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The Importer - Taric</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-importer.taric">
<span id="the-importer-taric"></span><h1>The Importer - Taric<a class="headerlink" href="#module-importer.taric" title="Permalink to this headline">¶</a></h1>
<p>Parsers for TARIC envelope entities.</p>
<dl class="py exception">
<dt class="sig sig-object py" id="importer.taric.EnvelopeError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">EnvelopeError</span></span><a class="reference internal" href="../../_modules/importer/taric.html#EnvelopeError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.EnvelopeError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="importer.taric.EnvelopeParser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">EnvelopeParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">workbasket_status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_scheme</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">workbaskets.models.TransactionPartitionScheme</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tamato_username</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#EnvelopeParser"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.EnvelopeParser" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="importer.taric.EnvelopeParser.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">lxml.etree.Element</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="parsers_and_namespaces.html#importer.parsers.ElementParser" title="importer.parsers.ElementParser"><span class="pre">importer.parsers.ElementParser</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#EnvelopeParser.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.EnvelopeParser.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle the start of an XML tag. The tag may not yet have all of its
children.</p>
<p>We have a few cases where there are tags nested within a tag of the same name.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;oub:additional.code&gt;</span>
    <span class="nt">&lt;oub:additional.code.sid&gt;</span>00000001<span class="nt">&lt;/oub:additional.code.sid&gt;</span>
    <span class="nt">&lt;oub:additional.code.type.id&gt;</span>A<span class="nt">&lt;/oub:additional.code.type.id&gt;</span>
    <span class="nt">&lt;oub:additional.code&gt;</span>AAA<span class="nt">&lt;/oub:additional.code&gt;</span>
    <span class="nt">&lt;oub:validity.start.date&gt;</span>2021-01-01<span class="nt">&lt;/oub:validity.start.date&gt;</span>
<span class="nt">&lt;/oub:additional.code&gt;</span>
</pre></div>
</div>
<p>In this case matching on tags is not enough and so we also need to keep
track of whether this parser is already parsing an element. If it is, we
don’t want to select any child parsers. If it is not, we know that this
is an element that this parser should be parsing.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="importer.taric.MessageParser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">MessageParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="parsers_and_namespaces.html#importer.namespaces.Tag" title="importer.namespaces.Tag"><span class="pre">importer.namespaces.Tag</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">many</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#MessageParser"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.MessageParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Parser for TARIC3 <cite>message</cite> element.</p>
<dl class="py method">
<dt class="sig sig-object py" id="importer.taric.MessageParser.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#MessageParser.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.MessageParser.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the contained records to the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A dict of parsed element, mapping field names to values</p></li>
<li><p><strong>transaction_id</strong> – The primary key of the transaction to add records to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="importer.taric.RecordParser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">RecordParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="parsers_and_namespaces.html#importer.namespaces.Tag" title="importer.namespaces.Tag"><span class="pre">importer.namespaces.Tag</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">many</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#RecordParser"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.RecordParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Parser for TARIC3 <cite>record</cite> element.</p>
<dl class="py method">
<dt class="sig sig-object py" id="importer.taric.RecordParser.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#RecordParser.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.RecordParser.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the Record to the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A dict of the parsed element, mapping field names to values</p></li>
<li><p><strong>transaction_id</strong> – The primary key of the transaction to add the record to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="importer.taric.TransactionParser">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">TransactionParser</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="parsers_and_namespaces.html#importer.namespaces.Tag" title="importer.namespaces.Tag"><span class="pre">importer.namespaces.Tag</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">many</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#TransactionParser"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.TransactionParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Parser for TARIC3 <cite>transaction</cite> element.</p>
<dl class="py method">
<dt class="sig sig-object py" id="importer.taric.TransactionParser.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">envelope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../exporter/celery-tasks.html#taric.models.Envelope" title="taric.models.Envelope"><span class="pre">taric.models.Envelope</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#TransactionParser.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.TransactionParser.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the transaction and the contained records to the database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A dict of the parsed element, containing at least an “id” and list
of “message” dicts</p></li>
<li><p><strong>envelope</strong> – Containing Envelope</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="importer.taric.process_taric_xml_stream">
<span class="sig-prename descclassname"><span class="pre">importer.taric.</span></span><span class="sig-name descname"><span class="pre">process_taric_xml_stream</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">taric_stream</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workbasket_status</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_scheme</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/importer/taric.html#process_taric_xml_stream"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.taric.process_taric_xml_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a TARIC XML stream through the import handlers.</p>
<p>This will load the data from the stream into the database.</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="parsers_and_namespaces.html"
                        title="previous chapter">The Importer - Parsers and Namespaces</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../exporter/index.html"
                        title="next chapter">The Exporter</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/importer/taric.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../exporter/index.html" title="The Exporter"
             >next</a> |</li>
        <li class="right" >
          <a href="parsers_and_namespaces.html" title="The Importer - Parsers and Namespaces"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../code.html" >Code Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >The Importer</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The Importer - Taric</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, DIT.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.0+.
    </div>
  </body>
</html>