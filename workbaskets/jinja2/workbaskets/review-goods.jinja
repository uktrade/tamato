{% extends "layouts/layout.jinja" %}
{% from "components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "components/button/macro.njk" import govukButton %}
{% from "components/table/macro.njk" import govukTable %}
{% from "includes/workbaskets/navigation.jinja" import navigation %}

{% set page_title %} Workbasket {{ request.session.workbasket.id }} - Review goods {% endset %}

{% block breadcrumb %}
{{ govukBreadcrumbs({
  "items": [
    {"text": "Home", "href": url("home")},
    {"text": "Edit an existing workbasket", "href": url("workbaskets:workbasket-ui-list")},
    {"text": "Workbasket " ~ request.session.workbasket.id ~ " - Review goods" }
  ]})
}}
{% endblock %}

{% block content %}
  <h1 class="govuk-heading-xl govuk-!-margin-bottom-3">
    {{ page_title }}
  </h1>

  {{ navigation(request, "review-goods") }}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

    <p class="govuk-body" style="display:inline-block">
      {{ paginator.count }} goods change{{ paginator.count|pluralize }} available to review.
    </p>

    {% if goods_changes %}

      {{ govukButton({
        "text": "Download as Excel",
        "href": "TODO",
        "classes": "govuk-button--secondary",
      }) }}

      {% set table_rows = [] %}
      {% for obj in goods_changes %}
        {{ table_rows.append([
          {"text": obj["update_type"]},
          {"text": obj["object"]},
          {"text": obj["goods_nomenclature"]},
          {"text": obj["suffix"]},
          {"text": obj["validity_start"]},
          {"text": obj["validity_end"]},
          {"text": obj["comments"]},
        ]) or "" }}
      {% endfor %}
          
      {{ govukTable({
        "head": [
          {"text": "Update type"},
          {"text": "What's being updated"},
          {"text": "Goods nomenclature code"},
          {"text": "Suffix"},
          {"text": "Validity start date"},
          {"text": "Validity end date"},
          {"text": "Comments"},
        ],
        "rows": table_rows
      }) }}
    {% endif %}
    
    {% set items_name = "goods changes" %}
    {% include "includes/common/pagination.jinja" %}

  </div>
</div>
{% endblock %}
