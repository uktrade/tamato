{% extends "layouts/layout.jinja" %}

{% from "components/table/macro.njk" import govukTable %}


{% set page_title = "Envelope " ~ object.xml_file_name ~ " history"%}


{% block breadcrumb %}
<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url('home') }}">Home</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url('publishing:envelope-list-ui-list') }}">Find processed envelopes</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      {{ page_title }}
    </li>
  </ol>
</div>
{% endblock %}


{% block content %}

{%- macro envelope_version_link(envelope_id, version_id) -%}
  <a
    class="govuk-link"
    href="{{ url('publishing:download-envelope-version-ui-download', kwargs={'envelope_id': envelope_id, 'version_id': version_id}) }}"
    target="_blank"
  >download</a>
{%- endmacro -%}

{%- set table_rows = [] -%}
{% for version in envelope.get_xml_file_versions() %}
  {%- set file_size = 0 %}
  {% if version.size %}
    {%- set file_size = version.size|filesizeformat(true) %}
  {% endif %}

  {{ table_rows.append([
      {"text": file_size},
      {"text": "{:%d %b %Y, %H:%M}".format(version.last_modified)},
      {"html": envelope_version_link(envelope.id, version.id)},
  ]) or "" }}
{% endfor %}

<h1 class="govuk-heading-xl">{{ page_title }}</h1>

<div class="govuk-grid-row govuk-!-margin-bottom-6">
  <div class="govuk-grid-column-full">

    <h2 class="govuk-heading-l">File version history</h2>

    {{ govukTable({
      "head": [
        {"text": "File size"},
        {"text": "Created"},
        {"text": "Action"},
      ],
      "rows": table_rows
    }) }}

  </div>
</div>
{% endblock %}
