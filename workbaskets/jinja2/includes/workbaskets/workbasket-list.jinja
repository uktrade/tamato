{% from "components/button/macro.njk" import govukButton %}
{% from "components/input/macro.njk" import govukInput %}
{% from "components/table/macro.njk" import govukTable %}

{%- set table_rows = [] -%}
{% for workbasket in object_list %}
  {%- set workbasket_linked_id -%}
    <a
      class="govuk-link"
      href="{{ url("workbaskets:workbasket-ui-detail", kwargs={"pk": workbasket.pk}) }}"
    >{{ workbasket.pk }}</a>
  {%- endset -%}
  {{ table_rows.append([
    {"text": workbasket_linked_id},
    {"html": workbasket.title},
    {"text": workbasket.reason},
    {"text": '{0:,}'.format(workbasket.tracked_models.count()) },
    {
      "html": "<span title=\"{:%d %b %y %H:%M}\">{:%d %b %y}</span>".format(
        workbasket.created_at,
        workbasket.created_at,
      )
    },
    {
      "html": "<span title=\"{:%d %b %y %H:%M}\">{:%d %b %y}</span>".format(
        workbasket.updated_at,
        workbasket.updated_at,
      )
    },
    {"text": workbasket.get_status_display()},
    {"text": workbasket.unchecked_or_errored_transactions.count() < 1},
    {"text": workbasket.tracked_model_check_errors.count()},
  ]) or "" }}
{% endfor %}

{{ govukTable({
  "head": [
    {"text": "ID"},
    {"text": "Title"},
    {"text": "Reason"},
    {"text": "Number of changes"},
    {"text": "Created"},
    {"text": "Updated*"},
    {"text": "Status"},
    {"text": "Successfully validated"},
    {"text": "Error count"},
  ],
  "rows": table_rows
}) }}
