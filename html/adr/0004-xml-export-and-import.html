<!DOCTYPE html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>4. XML Import and Export - DBT Tariff Management Tool</title>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/javascripts/_analytics.js"></script>
    <script src="../_static/javascripts/_govuk/govuk-frontend-3.10.2.min.js"></script>
    <script src="../_static/javascripts/_govuk/modules.js"></script>
    <script src="../_static/javascripts/_modules/anchored-headings.js"></script>
    <script src="../_static/javascripts/_modules/collapsible-navigation.js"></script>
    <script src="../_static/javascripts/_modules/in-page-navigation.js"></script>
    <script src="../_static/javascripts/_modules/navigation.js"></script>
    <script src="../_static/javascripts/_modules/page-expiry.js"></script>
    <script src="../_static/javascripts/_modules/table-of-contents.js"></script>
    <script src="../_static/javascripts/_start_modules.js"></script>
    <script src="../_static/javascripts/_vendor/fixedsticky.js"></script>
    <script src="../_static/javascripts/_vendor/lodash.js"></script>
    <script src="../_static/javascripts/_vendor/modernizer.js"></script>
    <script src="../_static/javascripts/govuk_tech_docs.js"></script>
    <script src="../_static/javascripts/theme.js"></script>
    <link href="../_static/stylesheets/manifest.css" rel="stylesheet" />
    <link href="../_static/stylesheets/theme.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../_static//favicon.ico"/>
  </head>
  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>
        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
          <div class="govuk-header__container govuk-header__container--full-width">

            <div class="govuk-header__logo">
  <a href="../index.html" class="govuk-header__link govuk-header__link--homepage">
    <span class="govuk-header__logotype"><image src="../_static/tudor-crown-logo.svg" xlink:href="" class="govuk-header__logotype-crown" height="30" width="36"></image>
      
      <span class="govuk-header__logotype-text">DBT</span>
    </span>
    <span class="govuk-header__product-name">Tariff Management Tool</span>
  </a><strong class="govuk-tag">Alpha</strong></div>
            <div class="govuk-header__content" role="navigation">
  <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
  <nav>
    <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
      <li class="govuk-header__navigation-item">
        <a class="govuk-header__link" href="https://github.com/uktrade/tamato">GitHub</a>
        </li>
    </ul>
  </nav>
</div>

          </div>
        </header>
      </div>
      <div id="toc-heading" class="toc-show fixedsticky">
        <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
        Table of contents <span class="toc-show__icon"></span>
        </a>
      </div>
      <div class="app-pane__body" data-module="in-page-navigation">

        <div class="app-pane__toc" role="navigation">
  <div class="toc" data-module="table-of-contents">
    <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>

    <div class="search" data-module="search">
  <form action="../search.html" method="get" role="search">
    <label class="govuk-label search__label" for="search">Search</label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
</div>

    <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">

      
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tariff Management Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../envvars.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architectural Decision Records</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="0002-use-pytest-bdd-for-bdd-testing.html">2. Use pytest-bdd for BDD testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="0003-use-django-rest-framework.html">3. Use Django REST Framework</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. XML Import and Export</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decision">Decision</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extraction">Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ingestion">Ingestion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="0005-use-model-tracking-and-workbaskets.html">5. Use tracked models and workbaskets</a></li>
<li class="toctree-l2"><a class="reference internal" href="0006-use-django-polymorphic.html">6. Use Django Polymorphic for Multi-Table Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="0007-changes-go-through-a-stateful-workflow.html">7. Changes go through a stateful workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="0008-simplify-workflow-states.html">8. Simplify workflow states</a></li>
<li class="toctree-l2"><a class="reference internal" href="0009-record-generated-envelopes.html">9. Generate envelope files</a></li>
<li class="toctree-l2"><a class="reference internal" href="0010-convert-the-importer-to-a-pipeline.html">10. Convert the XML importer to a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="0011-store-and-check-preference-codes.html">11. Store and check business rules around preference codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="0012-ordering-of-tariff-transactions.html">12. Ordering of tariff transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="0013-import-taric-nomenclature-updates.html">13. Import TARIC nomenclature updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="0014-simplify-current-transaction-queries.html">14. Simplification of current transaction queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="0015-make-reverse-relations-aware-of-versions.html">15. Make reverse relations aware of versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html">Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#context">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#transaction-types">Transaction Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#grouping-concepts">Grouping Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#problems">Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#decision">Decision</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#caveats">Caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#getting-data-into-the-correct-partition">Getting data into the correct partition</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#consequences">Consequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#conclusion-what-is-not-covered">Conclusion, what is not covered</a></li>
<li class="toctree-l2"><a class="reference internal" href="0016-split-transactions-into-partitions-to-simplify-global-transaction-ordering.html#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../business_rules/index.html">Business Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taric/index.html">TARIC3 Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../importer/index.html">The Importer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exporter/index.html">The Exporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/gherkin.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

      <hr size="1">

      
      <h1>On this page</h1>
      <ul>
<li><a class="reference internal" href="#">4. XML Import and Export</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#context">Context</a></li>
<li><a class="reference internal" href="#decision">Decision</a><ul>
<li><a class="reference internal" href="#extraction">Extraction</a></li>
<li><a class="reference internal" href="#ingestion">Ingestion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
</ul>


    </nav>
  </div>
</div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings" role="main">

            
  <section id="xml-import-and-export">
<span id="id1"></span><h1>4. XML Import and Export<a class="headerlink" href="#xml-import-and-export" title="Permalink to this headline">¶</a></h1>
<p>Date: 2020-05-07</p>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Approved, partially superseded by <a class="reference external" href="./0009-record-generated-envelopes">ADR-0009</a>.</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>The Tariff Management Tool (TaMaTo) must publish an up-to-date UK tariff
for reference by HMRC, Jersey and Guernsey border control agencies from
January 1st 2021.</p>
<p>There is a requirement to produce a TARIC 3 Full Extraction of the UK
tariff, and parse a Full Extraction of the EU tariff, and not just
Differential Extractions.</p>
<p>HMRC et al currently maintain their own copy of the EU tariff and
receive differential updates every day in the form of TARIC3 XML
documents.</p>
<p>After January 1st 2021 we will still need to process updates to the EU
tariff for reference especially with regard to tariffs on imports into
Northern Ireland.</p>
<p>HMRC also publishes tariff measures (VAT, etc) in the form of TARIC3 XML
documents which need to be incorporated into the UK tariff.</p>
<p>EU TARIC3 Differential Extractions are assigned a sequence number in the
form <code class="docutils literal notranslate"><span class="pre">YYnnn</span></code>, where <code class="docutils literal notranslate"><span class="pre">YY</span></code> is the last two digits of the current year
and <code class="docutils literal notranslate"><span class="pre">nnn</span></code> is a per-year sequence number This sequence starts from 001
for the first extraction of the year and is incremented by 1 for each
subsequent extraction.</p>
<p>Modification records to the tariff are grouped into transactions of
which there may be several in an extraction. Transactions have numeric
identifiers which must be unique within the extraction and in ascending
order but not necessarily contiguous.</p>
<p>Records are grouped into messages within a transaction of which there
may be several. Messages also have numerical sequence identifiers which
increment by 1 for each message in the extraction (not just the
transaction).</p>
<p>Records themselves have numeric sequence identifiers which increment by
1 for each record in the extraction.</p>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">¶</a></h2>
<p>We will build separate modules for ingesting TARIC3 Extractions of the
EU tariff and for producing TARIC3 Extractions of the UK tariff.</p>
<section id="extraction">
<h3>Extraction<a class="headerlink" href="#extraction" title="Permalink to this headline">¶</a></h3>
<p>The Extraction app will be a command line script, executed by a <code class="docutils literal notranslate"><span class="pre">cron</span></code>
job (or similar scheduling system) on a daily interval. It will produce
TARIC3 XML documents with the Jinja2 templating engine.</p>
<p>Transaction, Message and Record sequence identifiers will be generated
as part of the Jinja2 template rendering process. We will record the
stored identifiers.</p>
<p>Extraction sequence numbers (envelope IDs) will be generated by the
application on each run based on the data being exported.</p>
<p>The output of the app will be validated against the TARIC3 schema and
any validation errors will be reported to the development team via some
method. It is assumed that the records in the extraction have already
been validated against the business rules by TaMaTo.</p>
<p>The output of the app will (if valid) be uploaded to AWS S3 and made
available to HMRC etc via SFTP with AWS Transfer.</p>
</section>
<section id="ingestion">
<h3>Ingestion<a class="headerlink" href="#ingestion" title="Permalink to this headline">¶</a></h3>
<p>The Ingestion app will be a command line script, executed by a <code class="docutils literal notranslate"><span class="pre">cron</span></code>
job (or similar) on a daily interval. It will parse and validate TARIC3
XML documents downloaded from the EU or HMRC using <code class="docutils literal notranslate"><span class="pre">etree</span></code> and will
store the parsed data in the database.</p>
<p>Transactions in the parsed TARIC3 documents will be converted to TaMaTo
work baskets owned by special user accounts and may bypass the usual
approval process.</p>
<p>On unsuccessful ingestion of a document, the app will send a failure
notification to the development team.</p>
</section>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Permalink to this headline">¶</a></h2>
<p>Using the API instead of writing and reading from the database directly
would reduce coupling and increase cohesion. Validation of business
rules can be centralised and not duplicated. However, reading from the
API requires handling large data transfers over HTTP (but not over the
Internet, unless the API is not running in the same VPC) in addition to
the API reading data from the DB, so will add latency, and more code.
AMQP may be a better choice.</p>
<p>Using templates to render JSON to XML saves time, effort and resources
building an intermediate object model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library provides schema validation and incremental parsing
of XML documents, which reduces memory requirements.</p>
<p>Ingested data uploaded as workbaskets enables using the TaMaTo UI to
display updates to tariff managers in the same way as their own changes.</p>
</section>
</section>



          </main>

          <aside>
  <ul class="contribution-banner">
    
    <li><a href="https://github.com/uktrade/tamato/blob/main/docs/adr/0004-xml-export-and-import.rst">View source</a></li>
    <li><a href="https://github.com/uktrade/tamato/issues/new?labels=bug&amp;title=Re:%20'adr/0004-xml-export-and-import.rst'&amp;body=Problem%20with%20'adr/0004-xml-export-and-import.rst'%20(docs/)">Report problem</a></li>
    <li><a href="https://github.com/uktrade/tamato">GitHub Repo</a></li>
    
  </ul>
</aside>
          <footer class="govuk-footer app-footer" role="contentinfo">
<div class="govuk-footer__meta">
  <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
    <ul class="govuk-footer__inline-list">
      <li class="govuk-footer__inline-list-item">
        <a class="govuk-footer__link" href="../accessibility.html">Accessibility</a>
      </li>
      <li class="govuk-footer__inline-list-item">
        Built with <a class="govuk-footer__link" href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0 using the <a class="govuk-footer__link" href="https://www.github.com/ukgovdatascience/govuk-tech-docs-sphinx-theme">GOV.UK Tech Docs Sphinx Theme</a>.
      </li>
    </ul>
    <svg
      aria-hidden="true"
      focusable="false"
      class="govuk-footer__licence-logo"
      xmlns="http://www.w3.org/2000/svg"
      viewbox="0 0 483.2 195.7"
      height="17"
      width="41"
      >
      <path
        fill="currentColor"
        d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
    </svg>
    <span class="govuk-footer__licence-description">
    All content is available under the
    <a
      class="govuk-footer__link"
      href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
      rel="license"
      >Open Government Licence v3.0</a>, except where otherwise stated
    </span>
  </div>
  <div class="govuk-footer__meta-item">
    <a
      class="govuk-footer__link govuk-footer__copyright-logo"
      href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
  </div>
</div>
</footer>

        </div>
      </div>
    </div>
  </body>
</html>