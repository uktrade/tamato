
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>13. Import TARIC nomenclature updates &#8212; TaMaTo 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Business Rules" href="../business_rules/index.html" />
    <link rel="prev" title="12. Ordering of tariff transactions" href="0012-ordering-of-tariff-transactions.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../business_rules/index.html" title="Business Rules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0012-ordering-of-tariff-transactions.html" title="12. Ordering of tariff transactions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Project Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Architectural Decision Records</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">13. Import TARIC nomenclature updates</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="import-taric-nomenclature-updates">
<h1>13. Import TARIC nomenclature updates<a class="headerlink" href="#import-taric-nomenclature-updates" title="Permalink to this headline">¶</a></h1>
<p>Date: 2021-04-26</p>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Approved</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>The Northern Ireland Protocol (NIP) requires the classification hierarchy of the
United Kingdom to be the same or a superset of the classification hierarchy of
the European Union (so that a trade against a product from the UK tariff can be
unambiguously mapped to a product in the EU tariff).</p>
<p>This means that any changes made to the TARIC nomenclature must also be made to
the UK nomenclature. Specifically, this means only changes to the following
TARIC record types need to be reflected:</p>
<ul class="simple">
<li><p>Goods nomenclature</p></li>
<li><p>Goods nomenclature indent</p></li>
<li><p>Goods nomenclature description</p></li>
<li><p>Goods nomenclature origin</p></li>
<li><p>Goods nomenclature successor</p></li>
</ul>
<p>We will continue to have access to a TARIC XML feed that incorporates all of the
goods nomenclature changes for the lifetime of the NIP. We also have
<a class="reference internal" href="../importer/index.html#the-importer"><span class="std std-ref">The Importer</span></a> that can read this XML format and reflect the contents in
our database.</p>
<section id="scenarios">
<h3>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h3>
<section id="scenario-1-add-new-code">
<h4>Scenario 1: Add new code<a class="headerlink" href="#scenario-1-add-new-code" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-98517937a22cb24419f07437f95b949fcc518002.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph CodeAdded {
node [shape=circle, width=0.6, fixedsize=true];
C1 -- C2;
C1 -- C3;
C2 [color=green, fillcolor=lightgreen];
}</p></object></div>
<p>When a new child code is added, there is not any scope for business rule
violations on related data.</p>
</section>
<section id="scenario-2-delete-code-with-a-measure">
<h4>Scenario 2: Delete code with a measure<a class="headerlink" href="#scenario-2-delete-code-with-a-measure" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-ede4f10182cfb04143135d7e98198679d5ffefd1.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph CodeDeleted {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- C3;
C2 [color=red, fillcolor=pink];

C2 -- C2 [headlabel=&quot;M&quot;, color=transparent]
}</p></object></div>
<p><a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG34" title="commodities.business_rules.NIG34"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG34</span></code></a> and
<a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG35" title="commodities.business_rules.NIG35"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG35</span></code></a> do not allow a code to be deleted if
it still has a measure attached.</p>
</section>
<section id="scenario-3-delete-parent-causing-child-to-have-new-parent">
<h4>Scenario 3: Delete parent causing child to have new parent<a class="headerlink" href="#scenario-3-delete-parent-causing-child-to-have-new-parent" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-632b8152a9fb02df379a88196fc6b565ab6f5498.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph ParentCodeDeleted {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- C3;
C3 -- C4;
C2 -- C4 [style=dotted];

C3 [color=red, fillcolor=pink];

C2 -- C2 [headlabel=&quot;M&quot;, color=transparent];
C4 -- C4 [headlabel=&quot;M&quot;, color=transparent];
}</p></object></div>
<p>Deleting (or moving) a parent node can will cause the child node to inherit a
new parent. This happens implicitly without any change required to the child or
parent themselves. <a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME32" title="measures.business_rules.ME32"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME32</span></code></a> will not allow the
child code and its new parent to have measures that overlap.</p>
</section>
<section id="scenario-4-change-time-span">
<h4>Scenario 4: Change time span<a class="headerlink" href="#scenario-4-change-time-span" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-1e7f083929f5b805cf5ab43c28208fd551383b47.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph ChangeTimeSpan {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- C3;
C2 [color=goldenrod, fillcolor=lightgoldenrod];

C2 -- C2 [headlabel=&quot;M, F&quot;, color=transparent]
}</p></object></div>
<p><a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG30" title="commodities.business_rules.NIG30"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG30</span></code></a> and
<a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG31" title="commodities.business_rules.NIG31"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG31</span></code></a> do not allow a code to have its
validity dates modified if they don’t span the validity range of any measure
attached. <a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG22" title="commodities.business_rules.NIG22"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG22</span></code></a> has the same requirement
for footnotes.</p>
</section>
<section id="scenario-5-change-suffix-from-real-to-intermediate">
<h4>Scenario 5: Change suffix from real to intermediate<a class="headerlink" href="#scenario-5-change-suffix-from-real-to-intermediate" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-b70258066f3afd60e22d66e05a59b73f4f31ba23.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph ChangeSuffix {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- C3;
C3 -- C4;

C3 [color=goldenrod, fillcolor=lightgoldenrod];
C4 [color=green, fillcolor=lightgreen];

C3 -- C3 [headlabel=&quot;M&quot;, color=transparent];
}</p></object></div>
<p>When a code receives new children, a code can be converted into a non-declarable
code and new codes created underneath. If the suffix on a code is updated from
80 to non-80, <a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME7" title="measures.business_rules.ME7"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME7</span></code></a> does not allow measures to
continue to exist on the code.</p>
</section>
<section id="scenario-6-increase-indent-level-to-get-sibling-as-parent">
<h4>Scenario 6: Increase indent level to get sibling as parent<a class="headerlink" href="#scenario-6-increase-indent-level-to-get-sibling-as-parent" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-94dd865c72fb63c58c88f060a428df99b243b18d.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph IncreaseIndent {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- &quot;C3 v1&quot;;
C2 -- &quot;C3 v2&quot; [style=dotted, color=goldenrod];

&quot;C3 v1&quot; [color=goldenrod, fillcolor=lightgoldenrod];
&quot;C3 v2&quot; [color=goldenrod, fillcolor=lightgoldenrod];

&quot;C3 v1&quot; -- &quot;C3 v1&quot; [headlabel=&quot;M, F&quot;, color=transparent];
&quot;C3 v2&quot; -- &quot;C3 v2&quot; [headlabel=&quot;M, F&quot;, color=transparent];
C2 -- C2 [headlabel=&quot;M&quot;, color=transparent];
}</p></object></div>
<p>If the indent of a code is increased it can now appear under a new parent. Both
of the codes could have measures that previously did not overlap but now would.
<a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME32" title="measures.business_rules.ME32"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME32</span></code></a> does not allow two measures in the same
commodity code hierarchy to overlap.</p>
<p>If the item ID of the commodity code gets updated as well, it’s possible for
<a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME88" title="measures.business_rules.ME88"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME88</span></code></a> to complain because any measures that
exist on the code may only have applied to codes at a higher explosion level.</p>
<p>There is a similar problem for footnotes caused by
<a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME71" title="measures.business_rules.ME71"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME71</span></code></a> and
<a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG18" title="commodities.business_rules.NIG18"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG18</span></code></a>.</p>
</section>
<section id="scenario-7-change-indent-results-in-child-with-new-parent">
<h4>Scenario 7: Change indent results in child with new parent<a class="headerlink" href="#scenario-7-change-indent-results-in-child-with-new-parent" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-7e352c053d4b92cf3c9347adfc1cac6ac0ba3959.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph IndentChangeNewChild {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C1 -- &quot;C3 v1&quot;;
C2 -- &quot;C3 v2&quot; [style=dotted, color=goldenrod];
&quot;C3 v1&quot; -- C4;
C2 -- C4 [style=dotted, color=goldenrod];

&quot;C3 v1&quot; [color=goldenrod, fillcolor=lightgoldenrod];
&quot;C3 v2&quot; [color=goldenrod, fillcolor=lightgoldenrod];

C2 -- C2 [headlabel=&quot;M&quot;, color=transparent];
C4 -- C4 [headlabel=&quot;M&quot;, color=transparent];
}</p></object></div>
<p>In the same way as Scenario 6, changing the indent and/or item ID of a code can
cause measure business rules to fire. In this case however the measures do not
need to be on the code being moved. If the moved code had children which have
now received new parents, it’s possible to get any of the above errors on that
child’s measures instead, even though no change was made to the child itself.</p>
</section>
<section id="scenario-8-indent-change-results-in-taking-children-from-other-parent">
<h4>Scenario 8: Indent change results in taking children from other parent<a class="headerlink" href="#scenario-8-indent-change-results-in-taking-children-from-other-parent" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><object data="../../_images/graphviz-780e0c7de465d4c22ff48c632d1e14e2b5bef522.svg" type="image/svg+xml" class="graphviz">
<p class="warning">graph IndentChangeWithStolenChild {
node [shape=circle, width=0.6, fixedsize=true]
C1 -- C2;
C2 -- &quot;C3 v1&quot;;
C2 -- C4;
C1 -- &quot;C3 v2&quot; [style=dotted, color=goldenrod];
&quot;C3 v2&quot; -- C4 [style=dotted, color=goldenrod];

&quot;C3 v1&quot; [color=goldenrod, fillcolor=lightgoldenrod];
&quot;C3 v2&quot; [color=goldenrod, fillcolor=lightgoldenrod];

&quot;C3 v1&quot; -- &quot;C3 v1&quot; [headlabel=&quot;M&quot;, color=transparent];
&quot;C3 v2&quot; -- &quot;C3 v2&quot; [headlabel=&quot;M&quot;, color=transparent];
C4 -- C4 [headlabel=&quot;M&quot;, color=transparent];
}</p></object></div>
<p>In this case an indent change causes a code to take on new children again at a
risk of <a class="reference internal" href="../business_rules/measures.html#measures.business_rules.ME32" title="measures.business_rules.ME32"><code class="xref py py-class docutils literal notranslate"><span class="pre">ME32</span></code></a> errors. Note though that there
aren’t any other business rules that the child can trigger through having a new
parent.</p>
<p>Hence we learn that it will be sufficient to check all business rules on
a commodity code after its update and its <em>old</em> children – new children do not
need to be checked.</p>
</section>
</section>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">¶</a></h2>
<p>We will extend the importer system to be able to read and process just the goods
nomenclature changes in a TARIC XML delta and whilst ignoring all other changes.</p>
<p>The EU has the opportunity to update any of its own data to avoid business rule
errors that would occur when a nomenclature change is made. For example, to
avoid a <a class="reference internal" href="../business_rules/commodities.html#commodities.business_rules.NIG30" title="commodities.business_rules.NIG30"><code class="xref py py-class docutils literal notranslate"><span class="pre">NIG30</span></code></a> error may require some
updates to measure end or start dates, and these will need to be made in a
transaction <em>before</em> the nomenclature change.</p>
<p>But the UK tariff will not know about possible nomenclature changes before
ingesting them, so in general a change to the nomenclature could introduce a
business rule error. To account for this, the import system will need to look
for errors as each nomenclature change is ingested and retroactively add
transactions that update related data to avoid those errors from occuring.</p>
<p>In the simplest version of the algorithm, business rules are checked at the end
of each transaction and related data can simply be updated or deleted. Any holes
in the data that are left will need to be corrected manually.</p>
<p>Added transactions could simply delete all related data that causes errors, but
there are opportunities for automatic fixes that remove some need to manually
recreate errored data. Where these fixes are safe to generally make, they should
be used in favour of simply deleting data to minimise manual rework.</p>
<p>There are also opportunities for errors to occur on models that aren’t even
changed by the transaction, such as in Scenarios 3 and 7 above. So in addition
to running business rules on the goods nomenclature objects themselves, we will
also need to run them on any of the commodity code’s children that it had
<em>before</em> it was updated.</p>
<section id="behaviour-in-responding-to-business-rules">
<h3>Behaviour in responding to business rules<a class="headerlink" href="#behaviour-in-responding-to-business-rules" title="Permalink to this headline">¶</a></h3>
<p>The algorithm will need to respond to the following business rule violations:</p>
<section id="nig30-or-nig31">
<h4>NIG30 or NIG31<a class="headerlink" href="#nig30-or-nig31" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG30</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG30"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>When a goods nomenclature is used in a goods measure then the validity
period of the goods nomenclature must span the validity period of the goods
measure.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG31</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG31"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>When a goods nomenclature is used in an additional nomenclature measure
then the validity period of the goods nomenclature must span the validity
period of the additional nomenclature measure.</p>
</dd></dl>

<p>This can occur if goods nomenclature validity dates have been changed (e.g. to
introduce an end date where one was not present) but there are measures using that
nomenclature that are valid outside of the new period.</p>
<p>The course of action will be to reduce the validity period of the measure to
match the new constraint of the nomenclature. The validity period of the measure
should not be increased as this may not represent policy intent.</p>
<ul class="simple">
<li><p>If the nomenclature now ends before the measure, set the measure end date to
be the end date of the nomenclature.</p></li>
<li><p>If the nomenclature now starts after the measure, set the measure start date
to be the start date of the nomenclature.</p></li>
<li><p>If the nomenclature dates now no longer overlap with the measure, delete the measure.</p></li>
</ul>
</section>
<section id="nig22">
<h4>NIG22<a class="headerlink" href="#nig22" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG22</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG22"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>The period of the association with a footnote must be within the validity
period of the nomenclature.</p>
</dd></dl>

<p>This is similar to the above where the goods nomenclature validity dates have
been changed and now no longer cover the validity dates of a footnote
association.</p>
<p>The same rules as above should be applied with the footnote association in place
of the measure.</p>
</section>
<section id="nig34-or-nig35">
<h4>NIG34 or NIG35<a class="headerlink" href="#nig34-or-nig35" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG34</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG34"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>A goods nomenclature cannot be deleted if it is used in a goods
measure.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG35</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG35"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>A goods nomenclature cannot be deleted if it is used in an additional
nomenclature measure.</p>
</dd></dl>

<p>The goods nomenclature has just been deleted but there are a number of measures
that remain in existence.</p>
<p>The only course of action here is to delete the remaining measures.</p>
</section>
<section id="footnote-association">
<h4>Footnote association<a class="headerlink" href="#footnote-association" title="Permalink to this headline">¶</a></h4>
<p>There is in fact another case here which no business rule accounts for: the
goods nomenclature can be deleted whilst still in use on a footnote association.</p>
<p>As above, the only course of action is to delete the remaining associations.</p>
</section>
<section id="me1-or-me32">
<h4>ME1 or ME32<a class="headerlink" href="#me1-or-me32" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">measures.business_rules.</span></span><span class="sig-name descname"><span class="pre">ME1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/measures/business_rules.html#ME1"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>The combination of measure type, geographical area, goods nomenclature
item id, additional code type, additional code, order number, reduction
indicator and start date must be unique.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">measures.business_rules.</span></span><span class="sig-name descname"><span class="pre">ME32</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/measures/business_rules.html#ME32"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>There may be no overlap in time with other measure occurrences with a goods
code in the same nomenclature hierarchy which references the same measure
type, geo area, order number, additional code and reduction indicator.</p>
<p>This rule is not applicable for Meursing additional codes.</p>
</dd></dl>

<p>In this case a goods nomenclature is now a parent of something where before it
was not, and the measures defined on that nomenclature now overlap with measures
on another code.</p>
<p>This can be if:</p>
<ol class="arabic simple">
<li><p>the delta has created a new indent</p></li>
<li><p>the delta has updated the dates on an old indent</p></li>
<li><p>the delta has updated the indent on an old indent</p></li>
<li><p>the delta has deleted some other indent and now this one is valid longer</p></li>
<li><p>the delta has changed the item id on the commodity and now it lives elsewhere</p></li>
</ol>
<p>The strategy is to try and manouever the measure around the problematic indent
by updating the dates, which in case #1 or #2 can preserve as much data as
possible. If this isn’t possible, we have to just give up and delete the
measure.</p>
<ul class="simple">
<li><p>If the measure overlaps with start of indent, update measure end date to be
indent validity end</p></li>
<li><p>If the measure overlaps with the end of indent, update measure start date to
be indent validity end</p></li>
<li><p>If the measure overlaps with the full range of indent, delete measure</p></li>
</ul>
<p>A more complicated automatic fix involving trying to identify child codes that
should now host the measure is possible but requires more complex human
intervention, so it should not be used for now.</p>
</section>
<section id="me7">
<h4>ME7<a class="headerlink" href="#me7" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">measures.business_rules.</span></span><span class="sig-name descname"><span class="pre">ME7</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/measures/business_rules.html#ME7"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>The goods nomenclature code must be a product code.</p>
<p>It may not be an intermediate line.</p>
</dd></dl>

<p>It is technically possible to have the suffix of a goods nomenclature updated to
turn it from real to intermediate code where measures cannot be created.</p>
<p>The only feasible option is to delete the measure.</p>
</section>
<section id="me88-me71-and-nig18">
<h4>ME88, ME71 and NIG18<a class="headerlink" href="#me88-me71-and-nig18" title="Permalink to this headline">¶</a></h4>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">measures.business_rules.</span></span><span class="sig-name descname"><span class="pre">ME71</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/measures/business_rules.html#ME71"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Footnotes with a footnote type for which the application type = “CN footnotes”
cannot be associated with TARIC codes (codes with pos. 9-10 different from 00).</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">measures.business_rules.</span></span><span class="sig-name descname"><span class="pre">ME88</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/measures/business_rules.html#ME88"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>The level of the goods code cannot exceed the explosion level of the
measure type.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">commodities.business_rules.</span></span><span class="sig-name descname"><span class="pre">NIG18</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/commodities/business_rules.html#NIG18"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Footnotes with a footnote type for which the application type = “CN
footnotes” must be linked to CN lines (all codes up to 8 digits).</p>
</dd></dl>

<p>When the item ID of the goods nomenclature is updated, its possible that the
measures or footnotes attached to the goods nomenclature are no longer allowed
to be present because the application code of the associated footnote or
explosion level of the associated measure type may limit how low in the goods
hierarchy the association can be made.</p>
<p>In the case of ME71 or NIG18, the footnote associations with the measure or
commodity code respectively will need to be deleted. (Changes to item ID do not
have validity dates associated with them, but should be very rare.)</p>
<p>In the case of ME88, the measure will need to be deleted.</p>
</section>
</section>
<section id="full-algorithm">
<h3>Full algorithm<a class="headerlink" href="#full-algorithm" title="Permalink to this headline">¶</a></h3>
<div class="graphviz"><object data="../../_images/graphviz-3a4d5493d9022910021289121b399e7c9191eddb.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph BasicAlgorithm {
node [shape=box]
graph [ratio=1.414]

Start [shape=circle, color=green, label=&quot;&quot;]
Start -&gt; &quot;Find business rule violations&quot; [label=&quot;Model is a Goods Nomenclature or Indent&quot;]
Start -&gt; &quot;Save model&quot; [label=&quot;Model is Goods Nomenclature\nDescription,\nOrigin or Successor&quot;]
Start -&gt; &quot;Ignore model&quot; [label=&quot;Model is something else&quot;]

&quot;Find business rule violations&quot; -&gt; &quot;Violation is NIG30/31&quot;
  &quot;Violation is NIG30/31&quot; -&gt; &quot;Update measure end date&quot; [label=&quot;Updated to end sooner&quot;]
      &quot;Update measure end date&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is NIG30/31&quot; -&gt; &quot;Update measure start date&quot; [label=&quot;Updated to start later&quot;]
      &quot;Update measure start date&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is NIG30/31&quot; -&gt; &quot;Delete measure&quot; [label=&quot;No longer overlaps&quot;]
      &quot;Delete measure&quot; -&gt; &quot;Re-run business rules&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is NIG22&quot;
  &quot;Violation is NIG22&quot; -&gt; &quot;Update footnote association\nend date&quot; [label=&quot;Updated to end sooner&quot;]
      &quot;Update footnote association\nend date&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is NIG22&quot; -&gt; &quot;Update footnote association\nstart date&quot; [label=&quot;Updated to start later&quot;]
      &quot;Update footnote association\nstart date&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is NIG22&quot; -&gt; &quot;Delete association&quot; [label=&quot;No longer overlaps&quot;]
      &quot;Delete association&quot; -&gt; &quot;Re-run business rules&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Footnote association still exists&quot;
  &quot;Footnote association still exists&quot; -&gt; &quot;Delete association&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is NIG34/35&quot;
  &quot;Violation is NIG34/35&quot; -&gt; &quot;Delete measure&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is ME32&quot;
  &quot;Violation is ME32&quot; -&gt; &quot;Update measure end date\nto be indent validity start&quot; [label=&quot;Measure overlaps with\nstart of indent&quot;]
    &quot;Update measure end date\nto be indent validity start&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is ME32&quot; -&gt; &quot;Update measure start date\nto be indent validity end&quot; [label=&quot;Measure overlaps with\nend of indent&quot;]
    &quot;Update measure start date\nto be indent validity end&quot; -&gt; &quot;Re-run business rules&quot;
  &quot;Violation is ME32&quot; -&gt; &quot;Delete measure&quot; [label=&quot;Measure overlaps with\nfull range of indent&quot;]

&quot;Find business rule violations&quot; -&gt; &quot;Violation is ME7&quot;
  &quot;Violation is ME7&quot; -&gt; &quot;Delete measure&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is ME1&quot;
  &quot;Violation is ME1&quot; -&gt; &quot;Delete measure&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is ME71&quot;
  &quot;Violation is ME71&quot; -&gt; &quot;Delete association&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is NIG18&quot;
  &quot;Violation is NIG18&quot; -&gt; &quot;Delete association&quot;

&quot;Find business rule violations&quot; -&gt; &quot;Violation is ME88&quot;
  &quot;Violation is ME88&quot; -&gt; &quot;Delete measure&quot;

&quot;Re-run business rules&quot; -&gt; &quot;Find business rule violations&quot;

&quot;Find business rule violations&quot; -&gt; &quot;No violations on any measure&quot;
  &quot;No violations on any measure&quot; -&gt; &quot;Save model&quot;
}</p></object></div>
<p>Note that “save model” in the above diagram does not imply saving to the
database hasn’t already occured. In order to check most of these business rules
it will be necessary to save the goods nomenclature model first and then to put
the measure “before” it. Hence, the system will also need to be able to reorder
transactions that may have already been saved.</p>
<p>Note also that transaction IDs present in the XML should be ignored and each
transaction allocated the next subsequent transaction ID in UK global order.</p>
</section>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Permalink to this headline">¶</a></h2>
<p>Note that it is very possible for the EU to update goods nomenclature objects in
a way that break its own rules. But as the system doesn’t have a huge amount of
choice in the matter of whether to apply these, even if business rules on
imported nomenclature objects are checked, they need to be saved anyway.</p>
<p>If the system makes a change to related data the business rules for it will also
need to be run. This could result in violations of some business rule not listed
here which is outside the scope of the algorithm. In this case, the import will
need to abort and all changes should be rolled back.</p>
<p>As with any algorithm that makes arbitrary changes to its own state, it is
possible that repeated automatic fixes of data could result in a loop – one
business rule fix causes another to fire and the fix to that one causes the
original data to be recreated, etc. As a safety mechanism, the algorithm
probably needs a depth counter to understand how many passes of fixes have been
attempted for a given model. If this counter exceeds some finite configured
value, the import should fail and all changes should be rolled back.</p>
<p>Some advanced automatic fixing that avoids more holes in data is possible by
considering changes across multiple transactions. An example that has been
observed is a goods nomenclature being deleted and then recreated under a
different SID. Another example might be a goods nomenclature being removed and
then being recreated under a different heading.</p>
<p>In both of these cases, it would be nice to be able to apply automatic
resolutions based on all of the transactions processed, however this is
significantly harder to achieve as it requires a lot more storage of state. In
principle, state may need to be examined between import runs if the EU removes a
code on one day and then resurrects it on a subsequent day. So for now the
algorithm will only do the minimum required to avoid business rule violations
and only consider one transaction at a time with no memory between them.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">13. Import TARIC nomenclature updates</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#context">Context</a><ul>
<li><a class="reference internal" href="#scenarios">Scenarios</a><ul>
<li><a class="reference internal" href="#scenario-1-add-new-code">Scenario 1: Add new code</a></li>
<li><a class="reference internal" href="#scenario-2-delete-code-with-a-measure">Scenario 2: Delete code with a measure</a></li>
<li><a class="reference internal" href="#scenario-3-delete-parent-causing-child-to-have-new-parent">Scenario 3: Delete parent causing child to have new parent</a></li>
<li><a class="reference internal" href="#scenario-4-change-time-span">Scenario 4: Change time span</a></li>
<li><a class="reference internal" href="#scenario-5-change-suffix-from-real-to-intermediate">Scenario 5: Change suffix from real to intermediate</a></li>
<li><a class="reference internal" href="#scenario-6-increase-indent-level-to-get-sibling-as-parent">Scenario 6: Increase indent level to get sibling as parent</a></li>
<li><a class="reference internal" href="#scenario-7-change-indent-results-in-child-with-new-parent">Scenario 7: Change indent results in child with new parent</a></li>
<li><a class="reference internal" href="#scenario-8-indent-change-results-in-taking-children-from-other-parent">Scenario 8: Indent change results in taking children from other parent</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#decision">Decision</a><ul>
<li><a class="reference internal" href="#behaviour-in-responding-to-business-rules">Behaviour in responding to business rules</a><ul>
<li><a class="reference internal" href="#nig30-or-nig31">NIG30 or NIG31</a></li>
<li><a class="reference internal" href="#nig22">NIG22</a></li>
<li><a class="reference internal" href="#nig34-or-nig35">NIG34 or NIG35</a></li>
<li><a class="reference internal" href="#footnote-association">Footnote association</a></li>
<li><a class="reference internal" href="#me1-or-me32">ME1 or ME32</a></li>
<li><a class="reference internal" href="#me7">ME7</a></li>
<li><a class="reference internal" href="#me88-me71-and-nig18">ME88, ME71 and NIG18</a></li>
</ul>
</li>
<li><a class="reference internal" href="#full-algorithm">Full algorithm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="0012-ordering-of-tariff-transactions.html"
                        title="previous chapter">12. Ordering of tariff transactions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../business_rules/index.html"
                        title="next chapter">Business Rules</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/adr/0013-import-taric-nomenclature-updates.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../business_rules/index.html" title="Business Rules"
             >next</a> |</li>
        <li class="right" >
          <a href="0012-ordering-of-tariff-transactions.html" title="12. Ordering of tariff transactions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Project Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Architectural Decision Records</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">13. Import TARIC nomenclature updates</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, DIT.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.0+.
    </div>
  </body>
</html>