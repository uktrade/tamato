
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. XML Import and Export &#8212; TaMaTo 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. Use tracked models and workbaskets" href="0005-use-model-tracking-and-workbaskets.html" />
    <link rel="prev" title="3. Use Django REST Framework" href="0003-use-django-rest-framework.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="0005-use-model-tracking-and-workbaskets.html" title="5. Use tracked models and workbaskets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0003-use-django-rest-framework.html" title="3. Use Django REST Framework"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Project Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Architectural Decision Records</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">4. XML Import and Export</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="xml-import-and-export">
<span id="id1"></span><h1>4. XML Import and Export<a class="headerlink" href="#xml-import-and-export" title="Permalink to this headline">¶</a></h1>
<p>Date: 2020-05-07</p>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>Approved, partially superseded by <a class="reference external" href="./0009-record-generated-envelopes">ADR-0009</a>.</p>
</section>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>The Tariff Management Tool (TaMaTo) must publish an up-to-date UK tariff
for reference by HMRC, Jersey and Guernsey border control agencies from
January 1st 2021.</p>
<p>There is a requirement to produce a TARIC 3 Full Extraction of the UK
tariff, and parse a Full Extraction of the EU tariff, and not just
Differential Extractions.</p>
<p>HMRC et al currently maintain their own copy of the EU tariff and
receive differential updates every day in the form of TARIC3 XML
documents.</p>
<p>After January 1st 2021 we will still need to process updates to the EU
tariff for reference especially with regard to tariffs on imports into
Northern Ireland.</p>
<p>HMRC also publishes tariff measures (VAT, etc) in the form of TARIC3 XML
documents which need to be incorporated into the UK tariff.</p>
<p>EU TARIC3 Differential Extractions are assigned a sequence number in the
form <code class="docutils literal notranslate"><span class="pre">YYnnn</span></code>, where <code class="docutils literal notranslate"><span class="pre">YY</span></code> is the last two digits of the current year
and <code class="docutils literal notranslate"><span class="pre">nnn</span></code> is a per-year sequence number This sequence starts from 001
for the first extraction of the year and is incremented by 1 for each
subsequent extraction.</p>
<p>Modification records to the tariff are grouped into transactions of
which there may be several in an extraction. Transactions have numeric
identifiers which must be unique within the extraction and in ascending
order but not necessarily contiguous.</p>
<p>Records are grouped into messages within a transaction of which there
may be several. Messages also have numerical sequence identifiers which
increment by 1 for each message in the extraction (not just the
transaction).</p>
<p>Records themselves have numeric sequence identifiers which increment by
1 for each record in the extraction.</p>
</section>
<section id="decision">
<h2>Decision<a class="headerlink" href="#decision" title="Permalink to this headline">¶</a></h2>
<p>We will build separate modules for ingesting TARIC3 Extractions of the
EU tariff and for producing TARIC3 Extractions of the UK tariff.</p>
<section id="extraction">
<h3>Extraction<a class="headerlink" href="#extraction" title="Permalink to this headline">¶</a></h3>
<p>The Extraction app will be a command line script, executed by a <code class="docutils literal notranslate"><span class="pre">cron</span></code>
job (or similar scheduling system) on a daily interval. It will produce
TARIC3 XML documents with the Jinja2 templating engine.</p>
<p>Transaction, Message and Record sequence identifiers will be generated
as part of the Jinja2 template rendering process. We will record the
stored identifiers.</p>
<p>Extraction sequence numbers (envelope IDs) will be generated by the
application on each run based on the data being exported.</p>
<p>The output of the app will be validated against the TARIC3 schema and
any validation errors will be reported to the development team via some
method. It is assumed that the records in the extraction have already
been validated against the business rules by TaMaTo.</p>
<p>The output of the app will (if valid) be uploaded to AWS S3 and made
available to HMRC etc via SFTP with AWS Transfer.</p>
</section>
<section id="ingestion">
<h3>Ingestion<a class="headerlink" href="#ingestion" title="Permalink to this headline">¶</a></h3>
<p>The Ingestion app will be a command line script, executed by a <code class="docutils literal notranslate"><span class="pre">cron</span></code>
job (or similar) on a daily interval. It will parse and validate TARIC3
XML documents downloaded from the EU or HMRC using <code class="docutils literal notranslate"><span class="pre">etree</span></code> and will
store the parsed data in the database.</p>
<p>Transactions in the parsed TARIC3 documents will be converted to TaMaTo
work baskets owned by special user accounts and may bypass the usual
approval process.</p>
<p>On unsuccessful ingestion of a document, the app will send a failure
notification to the development team.</p>
</section>
</section>
<section id="consequences">
<h2>Consequences<a class="headerlink" href="#consequences" title="Permalink to this headline">¶</a></h2>
<p>Using the API instead of writing and reading from the database directly
would reduce coupling and increase cohesion. Validation of business
rules can be centralised and not duplicated. However, reading from the
API requires handling large data transfers over HTTP (but not over the
Internet, unless the API is not running in the same VPC) in addition to
the API reading data from the DB, so will add latency, and more code.
AMQP may be a better choice.</p>
<p>Using templates to render JSON to XML saves time, effort and resources
building an intermediate object model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library provides schema validation and incremental parsing
of XML documents, which reduces memory requirements.</p>
<p>Ingested data uploaded as workbaskets enables using the TaMaTo UI to
display updates to tariff managers in the same way as their own changes.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. XML Import and Export</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#context">Context</a></li>
<li><a class="reference internal" href="#decision">Decision</a><ul>
<li><a class="reference internal" href="#extraction">Extraction</a></li>
<li><a class="reference internal" href="#ingestion">Ingestion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="0003-use-django-rest-framework.html"
                        title="previous chapter">3. Use Django REST Framework</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="0005-use-model-tracking-and-workbaskets.html"
                        title="next chapter">5. Use tracked models and workbaskets</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/docs/adr/0004-xml-export-and-import.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="0005-use-model-tracking-and-workbaskets.html" title="5. Use tracked models and workbaskets"
             >next</a> |</li>
        <li class="right" >
          <a href="0003-use-django-rest-framework.html" title="3. Use Django REST Framework"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">TaMaTo 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Project Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Architectural Decision Records</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">4. XML Import and Export</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, DIT.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.0+.
    </div>
  </body>
</html>