<!DOCTYPE html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>The Nursery - DBT Tariff Management Tool</title>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/javascripts/_analytics.js"></script>
    <script src="../_static/javascripts/_govuk/govuk-frontend-3.10.2.min.js"></script>
    <script src="../_static/javascripts/_govuk/modules.js"></script>
    <script src="../_static/javascripts/_modules/anchored-headings.js"></script>
    <script src="../_static/javascripts/_modules/collapsible-navigation.js"></script>
    <script src="../_static/javascripts/_modules/in-page-navigation.js"></script>
    <script src="../_static/javascripts/_modules/navigation.js"></script>
    <script src="../_static/javascripts/_modules/page-expiry.js"></script>
    <script src="../_static/javascripts/_modules/table-of-contents.js"></script>
    <script src="../_static/javascripts/_start_modules.js"></script>
    <script src="../_static/javascripts/_vendor/fixedsticky.js"></script>
    <script src="../_static/javascripts/_vendor/lodash.js"></script>
    <script src="../_static/javascripts/_vendor/modernizer.js"></script>
    <script src="../_static/javascripts/govuk_tech_docs.js"></script>
    <script src="../_static/javascripts/theme.js"></script>
    <link href="../_static/stylesheets/manifest.css" rel="stylesheet" />
    <link href="../_static/stylesheets/theme.css" rel="stylesheet" />
    <link rel="shortcut icon" href="../_static//favicon.ico"/>
  </head>
  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>
        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
          <div class="govuk-header__container govuk-header__container--full-width">

            <div class="govuk-header__logo">
  <a href="../index.html" class="govuk-header__link govuk-header__link--homepage">
    <span class="govuk-header__logotype"><image src="../_static/tudor-crown-logo.svg" xlink:href="" class="govuk-header__logotype-crown" height="30" width="36"></image>
      
      <span class="govuk-header__logotype-text">DBT</span>
    </span>
    <span class="govuk-header__product-name">Tariff Management Tool</span>
  </a><strong class="govuk-tag">Alpha</strong></div>
            <div class="govuk-header__content" role="navigation">
  <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
  <nav>
    <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
      <li class="govuk-header__navigation-item">
        <a class="govuk-header__link" href="https://github.com/uktrade/tamato">GitHub</a>
        </li>
    </ul>
  </nav>
</div>

          </div>
        </header>
      </div>
      <div id="toc-heading" class="toc-show fixedsticky">
        <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
        Table of contents <span class="toc-show__icon"></span>
        </a>
      </div>
      <div class="app-pane__body" data-module="in-page-navigation">

        <div class="app-pane__toc" role="navigation">
  <div class="toc" data-module="table-of-contents">
    <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>

    <div class="search" data-module="search">
  <form action="../search.html" method="get" role="search">
    <label class="govuk-label search__label" for="search">Search</label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
</div>

    <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">

      
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Tariff Management Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../envvars.html">Environment variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adr/index.html">Architectural Decision Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../business_rules/index.html">Business Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taric/index.html">TARIC3 Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Importer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="handlers.html">Handlers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Nursery</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsers_and_namespaces.html">Parsers and Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="taric.html">Taric</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../exporter/index.html">The Exporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/gherkin.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

      <hr size="1">

      
      <h1>On this page</h1>
      <ul>
<li><a class="reference internal" href="#">The Nursery</a></li>
</ul>


    </nav>
  </div>
</div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings" role="main">

            
  <section id="module-importer.nursery">
<span id="the-nursery"></span><h1>The Nursery<a class="headerlink" href="#module-importer.nursery" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt class="sig sig-object py" id="importer.nursery.HandlerDoesNotExistError">
<em class="property"><span class="pre">exception</span> </em><span class="sig-prename descclassname"><span class="pre">importer.nursery.</span></span><span class="sig-name descname"><span class="pre">HandlerDoesNotExistError</span></span><a class="reference internal" href="../_modules/importer/nursery.html#HandlerDoesNotExistError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.HandlerDoesNotExistError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">importer.nursery.</span></span><span class="sig-name descname"><span class="pre">TariffObjectNursery</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">importer.cache.cache.ObjectCacheFacade</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides an interface between raw data and the Django modelling system for
the tariff.</p>
<p>The primary function is to take a raw python object (generally a dictionary)
and convert it into a row in the database via the Django models.</p>
<p>This layer of separation comes from the fact that often, when receiving
data, the system will receive incomplete data objects which depend on data
received later. As a result this “Nursery” is designed to store and look
after incomplete data objects until it can be matched with the rest of the
data and then dispatched to the database.</p>
<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.cache_current_instances">
<span class="sig-name descname"><span class="pre">cache_current_instances</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.cache_current_instances"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.cache_current_instances" title="Permalink to this definition">¶</a></dt>
<dd><p>Take all current instances of all TrackedModels in the data and cache
them.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.cache_object">
<span class="sig-name descname"><span class="pre">cache_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../api/common/common.models.html#common.models.TrackedModel" title="common.models.trackedmodel.TrackedModel"><span class="pre">common.models.trackedmodel.TrackedModel</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.cache_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.cache_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Caches an objects primary key and model name in the cache.</p>
<p>Key is generated based on the model name and the identifying fields used
to find it.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.clear_cache">
<span class="sig-name descname"><span class="pre">clear_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">repeats</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.clear_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.clear_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over the cache and handle any objects which can be resolved.</p>
<p>As the importer runs many objects are created before their proper
relationships can be found. In some cases these will be cleared by
interdependent handlers. However in some cases (foreign key links)
the objects are left dangling in the cache.</p>
<p>This method runs through the cache and tries to resolve all objects
that it can. As some of the objects often depend on other objects
which are also in the cache, but appear later, this method runs
recursively based on the <cite>repeats</cite> argument</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.generate_cache_key">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">generate_cache_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../api/common/common.models.html#common.models.TrackedModel" title="common.models.trackedmodel.TrackedModel"><span class="pre">common.models.trackedmodel.TrackedModel</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifying_fields</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.generate_cache_key"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.generate_cache_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a cache key based on the model name and the identifying
values used to find it.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.get_handler">
<span class="sig-name descname"><span class="pre">get_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.get_handler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.get_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Find a handler which matches the given tag.</p>
<p>If one is not found throw an error.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.get_handler_link_fields">
<span class="sig-name descname"><span class="pre">get_handler_link_fields</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">link_fields</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.get_handler_link_fields"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.get_handler_link_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Find all the unique link fields for a given model.</p>
<p>This gives all the combinations of fields used to identify a model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.get_obj_from_cache">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">get_obj_from_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="../api/common/common.models.html#common.models.TrackedModel" title="common.models.trackedmodel.TrackedModel"><span class="pre">common.models.trackedmodel.TrackedModel</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">identifying_fields</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.get_obj_from_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.get_obj_from_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches an object PK and model name from the cache if it exists.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.register_handler">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">register_handler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><span class="pre">BaseHandler</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.register_handler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.register_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a handler to the TariffObjectNursery class.</p>
<p>The nursery needs to be able to map all handlers against incoming data. To do this the
nursery needs a map of handlers. This method allows handlers to register themselves so
that they can be added to the internal nursery map - to be used when processing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.remove_object_from_cache">
<span class="sig-name descname"><span class="pre">remove_object_from_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="../api/common/common.models.html#common.models.TrackedModel" title="common.models.trackedmodel.TrackedModel"><span class="pre">common.models.trackedmodel.TrackedModel</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.remove_object_from_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.remove_object_from_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes an object from the importer cache. If an object has to be
deleted (generally done in dev only) then it is problematic to keep the
ID in the cache as well.</p>
<p>Key is generated based on the model name and the identifying fields used
to find it.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="importer.nursery.TariffObjectNursery.submit">
<span class="sig-name descname"><span class="pre">submit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">importer.utils.DispatchedObjectType</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/importer/nursery.html#TariffObjectNursery.submit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.TariffObjectNursery.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>Entrypoint for the nursery.</p>
<p>Handles whether an object can be dispatched to the database or, if some
pieces of data are missing, cached to await new data.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="importer.nursery.get_nursery">
<span class="sig-prename descclassname"><span class="pre">importer.nursery.</span></span><span class="sig-name descname"><span class="pre">get_nursery</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#importer.nursery.TariffObjectNursery" title="importer.nursery.TariffObjectNursery"><span class="pre">importer.nursery.TariffObjectNursery</span></a></span></span><a class="reference internal" href="../_modules/importer/nursery.html#get_nursery"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#importer.nursery.get_nursery" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience function for building a nursery object.</p>
</dd></dl>

</section>



          </main>

          <aside>
  <ul class="contribution-banner">
    
    <li><a href="https://github.com/uktrade/tamato/blob/main/docs/importer/nursery.rst">View source</a></li>
    <li><a href="https://github.com/uktrade/tamato/issues/new?labels=bug&amp;title=Re:%20'importer/nursery.rst'&amp;body=Problem%20with%20'importer/nursery.rst'%20(docs/)">Report problem</a></li>
    <li><a href="https://github.com/uktrade/tamato">GitHub Repo</a></li>
    
  </ul>
</aside>
          <footer class="govuk-footer app-footer" role="contentinfo">
<div class="govuk-footer__meta">
  <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">
    <ul class="govuk-footer__inline-list">
      <li class="govuk-footer__inline-list-item">
        <a class="govuk-footer__link" href="../accessibility.html">Accessibility</a>
      </li>
      <li class="govuk-footer__inline-list-item">
        Built with <a class="govuk-footer__link" href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0 using the <a class="govuk-footer__link" href="https://www.github.com/ukgovdatascience/govuk-tech-docs-sphinx-theme">GOV.UK Tech Docs Sphinx Theme</a>.
      </li>
    </ul>
    <svg
      aria-hidden="true"
      focusable="false"
      class="govuk-footer__licence-logo"
      xmlns="http://www.w3.org/2000/svg"
      viewbox="0 0 483.2 195.7"
      height="17"
      width="41"
      >
      <path
        fill="currentColor"
        d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
    </svg>
    <span class="govuk-footer__licence-description">
    All content is available under the
    <a
      class="govuk-footer__link"
      href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
      rel="license"
      >Open Government Licence v3.0</a>, except where otherwise stated
    </span>
  </div>
  <div class="govuk-footer__meta-item">
    <a
      class="govuk-footer__link govuk-footer__copyright-logo"
      href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
  </div>
</div>
</footer>

        </div>
      </div>
    </div>
  </body>
</html>