{% from "components/accordion/macro.njk" import govukAccordion %}

{% from 'workbaskets/macros/detail_tabs.jinja' import additional_code_detail_tabs with context %}
{% from 'workbaskets/macros/detail_tabs.jinja' import footnote_detail_tabs with context %}
{% from 'workbaskets/macros/detail_tabs.jinja' import measure_detail_tabs with context %}
{% from 'workbaskets/macros/detail_tabs.jinja' import regulation_details_tabs with context %}


{% set accordion_items = [] %}

{# Build the accordion's item list. #}
{% for object in object_list %}
  {% if object._meta.model_name == "additionalcode" %}
    {# Additional Code #}
    {% set item_heading = "Additional code: " ~ object.type.sid ~ object.code %}
    {% set item_content = additional_code_detail_tabs(object, omit_actions=True) %}
  {% elif object._meta.model_name == "footnote" %}
    {# Footnote #}
    {% set item_heading = "Footnote: " ~ object|string %}
    {% set item_content = footnote_detail_tabs(object, omit_actions=True) %}
  {% elif object._meta.model_name == "measure" %}
    {# Measure #}
    {% set item_heading = object._meta.verbose_name.title() ~ ": " ~ object.sid %}
    {% set item_content = measure_detail_tabs(object, omit_actions=True) %}
  {% elif object._meta.model_name == "regulation" %}
    {# Regulation #}
    {% set item_heading = object._meta.verbose_name.title() ~ ": " ~ object.regulation_id %}
    {% set item_content = regulation_details_tabs(object, omit_actions=True) %}
  {% else %}
    {# Everything else #}
    {% set object_description =
        object.get_described_object()
        if object.get_described_object
        else object.structure_code
    %}
    {% set item_heading = object._meta.verbose_name.title() ~ ": " ~ object_description %}
    {% set item_content = "" %}
  {% endif %}

  {% set item =
    {
      "heading": {
        "text": item_heading
      },
      "content": {
        "html": item_content,
        "text": "",
      },
      "summary": {
      }
    }
  %}

  {% set accordion_items = accordion_items.append(item) %}
{% endfor %}

{{ govukAccordion({
  "id": "accordion-default",
  "items": accordion_items
}) }}
